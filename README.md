# POWERSHELL-FMS #

This is a collection of powershell scripts to make FIleMaker Server DevOps automation and administration a little less painful at Proof. This collection of scripts is intended to help with the following tasks:

* encrypting/decrypting FileMaker Server admin console username and password so that we can use various powershell scripts to run as admin without storing sensitive info in cleartext
* running a number of fmsadmin commands without retyping username and password for each
* gracefully shutting down fms processes
* installing LetsEncrypt SSL certificates via Win-Acme <https://www.win-acme.com> or some other LetsEncrypt tool
* dynamically register new IP address with AWS Route53 when the server restarts/reboots
* running various aws commands such as S3 sync/backups and Route53 dynamic DNS updates [TODO]
  
## USAGE ##

1. **Download** the latest release from from our the public mirror on github, <https://github.com/ernestkoe/powershell-fms>
   
   Proof devs/affiliates who need the latest greatest stuff can find this on the proof bitbucket main respository: <https://bitbucket.org/proofgroup/powershell-fms/downloads/>

   Note: unsigned and untrusted powershell scripts list these won't out-of-the-box without changing PS's execution policy. Read about it here, <https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7>. I will get around to signing these one day.

2. **Unpack** these files into a directory such as `C:\Program Files\proof-powershell-fms\`

3. **Configure** `fms\config.json` before you can use the scripts in the `fms` folder.

4. After configuring `fms\config.json`, you should first create an encrypted username and password file so that the other scripts can perform `fmsadmin` commands on your behalf.

## fms scripts ##

### EncyptFMSCreds.ps1 ###

`EncyptFMSCreds.ps1` saves your FileMaker Server admin console credentials to an encrypted file object for use by robots, scheduled events or other scripts to do `fmsadmin` commands on your behalf.

`cd` to the fms scripts folder, e.g. `C:\Program Files\proof-powershell-fms\fms`, then run from your powershell prompt:
 

      > .\EncyptFMSCreds.ps1

Advanced: You can also pass it parameters to override stuff in the config file like so:

     > EncyptFMSCreds.ps1 -filename "{filename}" -path "{somepath}" -u "{fmsadminUsername}" -p "{fmsadminPassword}"

Note: Quotes are optional and are used to escape arguments that contain spaces.

Example:
  
     .\EncyptFMSCreds.ps1 -filename fmsSecrets.xml -path C:\mysecrets -u theadminuser -p thepassword

#### InstallSSLCerts.ps1 ####

`InstallSSLCerts.ps1` is a powershell script that imports LetsEncrypt certificates generated by WACS (win-acme) or similar tools into FileMaker Server 16 and later. It uses the credentials file generated by the `EncryptFMSCredentials.ps1` script above to tell perform `fmsadmin` `CERTIFICATE` commands on your behalf.


#### sudofmsadmin.ps1 ####

`sudofmsadmin.ps` runs fmsadmin commands on your behalf, using


## Route53 ##

DynamicDns stuff

### R53 Scripts ###

* Updates Route53 DNS
* RefreshR53.ps1
* UpsertR53.ps1

#### Requirements #####

* set up an AWS IAM user
* download Windows AWS Tools
* download Windows AWS CLI Tools
  
#### Known Issues #####

Not tested on MacOS X. May work with tweaks to paths but ymmv.
